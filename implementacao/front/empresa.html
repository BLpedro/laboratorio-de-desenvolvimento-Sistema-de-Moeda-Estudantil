<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CRUD de Empresas Parceiras</title>
<style>
:root{
  --bg:#f4f7fb;
  --card:#ffffff;
  --accent:#5561f2;
  --muted:#7b8794;
  --radius:12px;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:linear-gradient(180deg,var(--bg),#eef2ff);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:32px;
  flex-direction:column;
}
.wrap{
  width:100%;
  max-width:960px;
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:0 10px 30px rgba(36,59,85,0.08);
  padding:28px;
  display:flex;
  flex-direction:column;
  gap:24px;
}
h1{text-align:center;margin:0 0 12px;font-size:24px;color:#243b55;}
form{padding:8px;}
.grid{display:grid;gap:12px;grid-template-columns:repeat(2,1fr);}
label{font-size:13px;color:#243b55;display:block;margin-bottom:6px;}
input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #e6eef8;background:#fbfdff;font-size:14px;outline:none;transition:box-shadow .12s,border-color .12s;}
input:focus{box-shadow:0 6px 18px rgba(85,97,242,0.12);border-color:var(--accent);}
.full{grid-column:1 / -1;}
.actions{display:flex;gap:12px;align-items:center;margin-top:8px;justify-content:center;}
button{padding:11px 16px;border-radius:10px;border:0;font-weight:600;background:var(--accent);color:#fff;cursor:pointer;box-shadow:0 8px 20px rgba(85,97,242,0.12);}
.btn-ghost{background:transparent;color:var(--accent);border:1px solid rgba(85,97,242,0.3)}
table{width:100%;border-collapse:collapse;font-size:14px;}
th,td{padding:10px;border-bottom:1px solid #e6eef8;text-align:left;}
th{background:#f8f9ff;color:#243b55;}
tr:hover{background:#f9faff;}
.btn-sm{padding:6px 10px;font-size:13px;border-radius:8px;}
.btn-edit{background:#4caf50;}
.btn-delete{background:#e74c3c;}
</style>
</head>
<body>
<main class="wrap">
  <h1>Gerenciamento de Empresas Parceiras</h1>

  <!-- Formulário -->
  <form id="cadastroForm" novalidate>
    <input type="hidden" id="id" name="id" />
    <div class="grid">
      <div><label>Login *</label><input id="login" name="login" required /></div>
      <div><label>Senha *</label><input id="senha" name="senha" type="password" required /></div>
      <div><label>Nome *</label><input id="nome" name="nome" required /></div>
      <div><label>CNPJ</label><input id="cnpj" name="cnpj" pattern="\d{14}" /></div>
    </div>
    <div class="actions">
      <button type="submit" id="btnSalvar">Cadastrar</button>
      <button type="button" class="btn-ghost" id="btnCancelar" style="display:none;">Cancelar</button>
    </div>
  </form>

  <!-- Lista de empresas -->
  <section>
    <h2 style="font-size:18px;margin-bottom:10px;">Lista de Empresas</h2>
    <table>
      <thead>
        <tr><th>ID</th><th>Nome</th><th>Login</th><th>CNPJ</th><th>Ações</th></tr>
      </thead>
      <tbody id="empresaList"></tbody>
    </table>
  </section>
</main>

<script>
const API_EMPRESAS = "http://localhost:8080/empresas";
const form = document.getElementById("cadastroForm");
const list = document.getElementById("empresaList");
const btnSalvar = document.getElementById("btnSalvar");
const btnCancelar = document.getElementById("btnCancelar");

// ---- Carregar empresas ----
async function carregarEmpresas(){
  try{
    const res = await fetch(API_EMPRESAS);
    const empresas = await res.json();
    list.innerHTML = empresas.map(e=>`
      <tr>
        <td>${e.id}</td>
        <td>${e.nome}</td>
        <td>${e.login}</td>
        <td>${e.cnpj || "-"}</td>
        <td>
          <button class="btn-sm btn-edit" onclick="editarEmpresa(${e.id})">Editar</button>
          <button class="btn-sm btn-delete" onclick="excluirEmpresa(${e.id})">Excluir</button>
        </td>
      </tr>
    `).join("");
  }catch(err){
    console.error("Erro ao carregar empresas:",err);
  }
}

// ---- Salvar / Atualizar ----
async function salvarEmpresa(e){
  e.preventDefault();
  const empresa = {
    login: form.login.value,
    senha: form.senha.value,
    nome: form.nome.value,
    cnpj: form.cnpj.value
  };
  const id = form.id.value;
  const method = id ? "PUT" : "POST";
  const url = id ? `${API_EMPRESAS}/${id}` : API_EMPRESAS;
  try{
    const res = await fetch(url,{
      method,
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(empresa)
    });
    if(res.ok){
      alert(id ? "Empresa atualizada!" : "Empresa cadastrada!");
      form.reset();
      form.id.value="";
      btnSalvar.textContent="Cadastrar";
      btnCancelar.style.display="none";
      carregarEmpresas();
    }else{
      const msg = await res.text();
      alert("Erro: "+msg);
    }
  }catch{
    alert("Erro de conexão com o servidor.");
  }
}

// ---- Editar ----
async function editarEmpresa(id){
  try{
    const res = await fetch(`${API_EMPRESAS}/${id}`);
    const e = await res.json();
    form.id.value = e.id;
    form.login.value = e.login;
    form.senha.value = "";
    form.nome.value = e.nome;
    form.cnpj.value = e.cnpj || "";
    btnSalvar.textContent="Atualizar";
    btnCancelar.style.display="inline-block";
    window.scrollTo({top:0,behavior:"smooth"});
  }catch{
    alert("Erro ao carregar empresa.");
  }
}

// ---- Excluir ----
async function excluirEmpresa(id){
  if(!confirm("Deseja realmente excluir esta empresa?")) return;
  try{
    const res = await fetch(`${API_EMPRESAS}/${id}`,{method:"DELETE"});
    if(res.ok){
      alert("Empresa excluída!");
      carregarEmpresas();
    }else alert("Erro ao excluir empresa.");
  }catch{
    alert("Erro de conexão com o servidor.");
  }
}

// ---- Cancelar edição ----
btnCancelar.addEventListener("click",()=>{
  form.reset();
  form.id.value="";
  btnSalvar.textContent="Cadastrar";
  btnCancelar.style.display="none";
});

form.addEventListener("submit", salvarEmpresa);
window.editarEmpresa = editarEmpresa;
window.excluirEmpresa = excluirEmpresa;

carregarEmpresas();
</script>
</body>
</html>
